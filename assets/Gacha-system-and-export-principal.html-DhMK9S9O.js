import{_ as a,c as t,f as n,o as i}from"./app-j_0OX3Wz.js";const l={};function r(o,e){return i(),t("div",null,e[0]||(e[0]=[n('<h1 id="祈愿系统与导出原理" tabindex="-1"><a class="header-anchor" href="#祈愿系统与导出原理"><span>祈愿系统与导出原理</span></a></h1><blockquote><p>Gacha System and Principal</p></blockquote><p>胡桃的祈愿系统相较 Snap Genshin 进行了整体架构上的重新设计。</p><p>本文将解释原神的祈愿记录机制和胡桃工具箱祈愿导出功能的技术原理。</p><hr><h2 id="祈愿的获取" tabindex="-1"><a class="header-anchor" href="#祈愿的获取"><span>祈愿的获取</span></a></h2><p>获取祈愿记录需要请求米哈游的 API。</p><p>关于此 API，有以下注意事项：</p><ul><li>通过米哈游服务器的 API，只能查询到过去一年内的祈愿记录。 <ul><li>这也是原神客户端中祈愿记录的来源。</li></ul></li><li>API 存在请求速率限制，过快的请求会导致后续的请求失败，从而无法正常获取数据。</li></ul><h3 id="请求-api-的关键参数" tabindex="-1"><a class="header-anchor" href="#请求-api-的关键参数"><span>请求 API 的关键参数</span></a></h3><p>为了请求此 API，我们需要以下四个关键参数：</p><ol><li>卡池类型</li><li>抽卡物品</li><li>时间</li><li>抽卡记录 ID</li></ol><ul><li>当前已知获取这些参数的方法包括： <ol><li>遍历 Unity 的日志文件，查找用户打开的祈愿记录 URL。</li><li>代理本机流量，筛选祈愿记录 URL。</li><li>查找 <code>CefBrowser</code> 的浏览器缓存，找到祈愿记录 URL。</li><li>使用包含 <code>SToken</code> 的 Cookie 调用 <code>genAuthKey</code> API，获取参数。</li><li>让高级用户手动输入相关 URL。</li></ol></li></ul><h3 id="数据拼接与完整记录生成" tabindex="-1"><a class="header-anchor" href="#数据拼接与完整记录生成"><span>数据拼接与完整记录生成</span></a></h3><p>在请求 API 后，可以获取到零散的祈愿记录。将这些记录拼接后即可生成一份完整的祈愿记录列表。</p><hr><h2 id="祈愿的存储" tabindex="-1"><a class="header-anchor" href="#祈愿的存储"><span>祈愿的存储</span></a></h2><p>完整的祈愿记录列表在获取后会被序列化存储于本地数据库中，并在需要时反序列化以呈现给用户。</p><ul><li>在后续请求中，胡桃只需与数据库中的数据对比，以获取新增部分的数据。</li><li>这种方式确保了用户可以长期保存帐号的完整祈愿记录。</li></ul><hr><h2 id="uigf-格式" tabindex="-1"><a class="header-anchor" href="#uigf-格式"><span>UIGF 格式</span></a></h2><blockquote><p>统一可交换祈愿记录标准<br> Uniformed Interchangeable GachaLog Format Standard</p></blockquote><p><code>UIGF</code> 是由我们联合其他祈愿记录应用共同倡导、推出并<strong>长期维护</strong>的一个统一祈愿记录数据交换标准。</p><p>标准化的数据格式允许用户在不同工具间自由转移数据，从而使用各工具的特色功能。</p><h3 id="祈愿的导入" tabindex="-1"><a class="header-anchor" href="#祈愿的导入"><span>祈愿的导入</span></a></h3><p>使用 <code>UIGF</code> 数据格式，可以导入其他应用中储存的祈愿记录数据。</p><ul><li>胡桃在导入数据时，会对比本地存储中的最早索引（ID），仅导入更早的记录。</li><li>新数据始终可以从米哈游服务器获取，其原始数据精度更高。</li></ul><h3 id="祈愿的导出" tabindex="-1"><a class="header-anchor" href="#祈愿的导出"><span>祈愿的导出</span></a></h3><p>胡桃支持将祈愿记录以 <code>UIGF</code> 数据格式保存为文件，并输出至用户指定的文件夹。</p><p>用户可以通过导出的文件在其他支持 <code>UIGF</code> 格式的工具中继续使用祈愿记录。</p>',30)]))}const h=a(l,[["render",r],["__file","Gacha-system-and-export-principal.html.vue"]]),c=JSON.parse('{"path":"/zh/advanced/Gacha-system-and-export-principal.html","title":"祈愿系统与导出原理","lang":"zh-CN","frontmatter":{"headerDepth":2,"category":["FAQ"],"icon":"iconfont icon-read","order":8,"comment":false,"description":"Snap Hutao 使用多种方式获取用户的登录信息并配合原神 API 获取祈愿记录。","banner":"https://opengraph.snapgenshin.cn/generate?url=https://hut.ao/zh/advanced/Gacha-system-and-export-principal.html&has_description=False","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://hut.ao/en/advanced/Gacha-system-and-export-principal.html"}],["link",{"rel":"alternate","hreflang":"id-id","href":"https://hut.ao/id/advanced/Gacha-system-and-export-principal.html"}],["link",{"rel":"alternate","hreflang":"ru-ru","href":"https://hut.ao/ru/advanced/Gacha-system-and-export-principal.html"}],["link",{"rel":"alternate","hreflang":"ja-jp","href":"https://hut.ao/jp/advanced/Gacha-system-and-export-principal.html"}],["meta",{"property":"og:url","content":"https://hut.ao/zh/advanced/Gacha-system-and-export-principal.html"}],["meta",{"property":"og:site_name","content":"胡桃工具箱"}],["meta",{"property":"og:title","content":"祈愿系统与导出原理"}],["meta",{"property":"og:description","content":"Snap Hutao 使用多种方式获取用户的登录信息并配合原神 API 获取祈愿记录。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://opengraph.snapgenshin.cn/generate?url=https://hut.ao/zh/advanced/Gacha-system-and-export-principal.html&has_description=False"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"id-ID"}],["meta",{"property":"og:locale:alternate","content":"ru-RU"}],["meta",{"property":"og:locale:alternate","content":"ja-JP"}],["meta",{"property":"og:updated_time","content":"2025-01-12T04:59:21.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://opengraph.snapgenshin.cn/generate?url=https://hut.ao/zh/advanced/Gacha-system-and-export-principal.html&has_description=False"}],["meta",{"name":"twitter:image:alt","content":"祈愿系统与导出原理"}],["meta",{"property":"article:modified_time","content":"2025-01-12T04:59:21.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"祈愿系统与导出原理\\",\\"image\\":[\\"https://opengraph.snapgenshin.cn/generate?url=https://hut.ao/zh/advanced/Gacha-system-and-export-principal.html&has_description=False\\"],\\"dateModified\\":\\"2025-01-12T04:59:21.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"DGP-Studio\\",\\"url\\":\\"https://github.com/DGP-Studio\\"}]}"],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://hut.ao/zh/rss.xml","title":"胡桃工具箱 RSS Feed"}]]},"headers":[{"level":2,"title":"祈愿的获取","slug":"祈愿的获取","link":"#祈愿的获取","children":[{"level":3,"title":"请求 API 的关键参数","slug":"请求-api-的关键参数","link":"#请求-api-的关键参数","children":[]},{"level":3,"title":"数据拼接与完整记录生成","slug":"数据拼接与完整记录生成","link":"#数据拼接与完整记录生成","children":[]}]},{"level":2,"title":"祈愿的存储","slug":"祈愿的存储","link":"#祈愿的存储","children":[]},{"level":2,"title":"UIGF 格式","slug":"uigf-格式","link":"#uigf-格式","children":[{"level":3,"title":"祈愿的导入","slug":"祈愿的导入","link":"#祈愿的导入","children":[]},{"level":3,"title":"祈愿的导出","slug":"祈愿的导出","link":"#祈愿的导出","children":[]}]}],"git":{"createdTime":1664413369000,"updatedTime":1736657961000,"contributors":[{"name":"Masterain","username":"Masterain","email":"i@irain.in","commits":19,"url":"https://github.com/Masterain"},{"name":"Mikachu2333","username":"Mikachu2333","email":"mikachu.23333@zohomail.com","commits":3,"url":"https://github.com/Mikachu2333"},{"name":"Xt-0","username":"Xt-0","email":"114323763+Sczr0@users.noreply.github.com","commits":1,"url":"https://github.com/Xt-0"},{"name":"LinkChou","username":"LinkChou","email":"linkchou@yandex.com","commits":2,"url":"https://github.com/LinkChou"},{"name":"Mr.Hope","username":"Mr.Hope","email":"mister-hope@outlook.com","commits":1,"url":"https://github.com/Mr.Hope"}]},"readingTime":{"minutes":2.57,"words":770},"filePathRelative":"zh/advanced/Gacha-system-and-export-principal.md","localizedDate":"2022年9月29日"}');export{h as comp,c as data};
