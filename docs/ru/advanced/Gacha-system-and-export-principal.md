---
headerDepth: 2
category: [FAQ]
icon: iconfont icon-read
order: 8
comment: false
description: Snap Hutao использует различные методы для получения информации для входа пользователя и API Genshin Impact для получения истории молитв.
banner: https://opengraph.snapgenshin.cn/generate?url=https://hut.ao/zh/advanced/Gacha-system-and-export-principal.html&has_description=False
---

# Система молитв и принцип экспорта

> Gacha System and Principal

Система молитв в Snap Hutao была полностью переработана по сравнению со Snap Genshin.

В этой статье объясняются механизмы истории молитв в Genshin Impact и технические принципы функции экспорта молитв в Snap Hutao.

::: important
Это перевод, сделанный моделью Google Gemini, и мы приветствуем исправления посредством PR.
:::

## Получение молитв

Для получения истории молитв требуется запрос к API miHoYo.

Об этом API следует знать следующее:

- Через API сервера miHoYo можно получить историю молитв только за последний год.
  - Это также источник истории молитв в клиенте Genshin Impact.
- API имеет ограничение скорости запросов, слишком быстрые запросы приведут к сбою последующих запросов и невозможности нормального получения данных.

### Ключевые параметры запроса API

Для запроса этого API нам необходимы следующие четыре ключевых параметра:

1. Тип баннера
2. Предметы, полученные в молитвах
3. Время
4. ID истории молитв

- В настоящее время известны следующие способы получения этих параметров:
  1. Перебор файлов журнала Unity в поисках URL-адреса истории молитв, открытого пользователем.
  2. Проксирование локального трафика и фильтрация URL-адреса истории молитв.
  3. Поиск в кеше браузера `CefBrowser` для нахождения URL-адреса истории молитв.
  4. Использование Cookie, содержащего `SToken`, для вызова API `genAuthKey` и получения параметров.
  5. Ручной ввод соответствующих URL-адресов продвинутыми пользователями.

### Сборка данных и создание полной истории

После запроса API можно получить разрозненные записи истории молитв. После сборки этих записей можно создать полный список истории молитв.

---

## Хранение молитв

Полный список истории молитв после получения сериализуется и сохраняется в локальной базе данных, а при необходимости десериализуется для отображения пользователю.

- В последующих запросах Snap Hutao нужно только сравнить данные с данными в базе данных, чтобы получить новые данные.
- Этот способ гарантирует, что пользователи смогут долгосрочно хранить полную историю молитв своей учетной записи.

---

## Формат UIGF

> Унифицированный стандарт обмена записями молитв
> Uniformed Interchangeable GachaLog Format Standard

`UIGF` — это унифицированный стандарт обмена данными истории молитв, разработанный и продвигаемый нами совместно с другими приложениями для истории молитв и **поддерживаемый на постоянной основе**.

Стандартизированный формат данных позволяет пользователям свободно переносить данные между различными инструментами, чтобы использовать различные функции каждого инструмента.

### Импорт молитв

Используя формат данных `UIGF`, можно импортировать данные истории молитв, сохраненные в других приложениях.

- При импорте данных Snap Hutao сравнивает самый ранний индекс (ID) в локальном хранилище и импортирует только более старые записи.
- Новые данные всегда можно получить с сервера miHoYo, и их исходные данные являются более точными.

### Экспорт молитв

Snap Hutao поддерживает сохранение истории молитв в виде файла формата `UIGF` и вывод его в папку, указанную пользователем.

Пользователи могут продолжать использовать историю молитв через экспортированные файлы в других инструментах, поддерживающих формат `UIGF`.
